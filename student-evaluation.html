<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>แบบประเมินการสอน</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@400;600&display=swap');
    body { 
      font-family: 'Kanit', Tahoma, Arial, sans-serif; 
      background: #f7fafd; 
      margin: 0; 
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 1em 0;
    }
    .container { 
      background: #fff; 
      padding: 2em; 
      border-radius: 18px; 
      max-width: 600px; 
      width: 95%;
      margin: 2em auto; 
      box-shadow: 0 8px 36px rgba(44, 62, 80, 0.11);
    }
    h2 { 
      text-align: center; 
      color: #2d87f0; 
      margin-top: 0; 
      margin-bottom: 1.5em;
    }
    .form-group { 
      margin-bottom: 1.5em;
    }
    label { 
      display: block; 
      margin-bottom: 0.5em; 
      color: #37474f; 
      font-weight: 500;
    }
    select, input[type="text"], textarea { 
      width: 100%; 
      box-sizing: border-box;
      padding: 0.7em; 
      border: 1.5px solid #b0bec5; 
      border-radius: 6px; 
      font-size: 1em; 
      font-family: inherit;
    }
    input[readonly] {
      background-color: #f0f0f0;
      cursor: not-allowed;
    }
    select:focus, input[type="text"]:focus, textarea:focus { 
      outline: none; 
      border-color: #2d87f0; 
      background: #e3f2fd;
    }
    .rating-group { 
      display: flex; 
      justify-content: space-around; 
      flex-wrap: wrap;
      margin: 1em 0;
      gap: 10px;
    }
    .rating-option { 
      display: flex;
      align-items: center;
      gap: 0.5em;
    }
    button[type="submit"] { 
      width: 100%; 
      padding: 0.8em; 
      background: linear-gradient(90deg,#2d87f0 60%,#5ad4fc 100%); 
      color: white; 
      border: none; 
      border-radius: 6px; 
      font-size: 1.1em; 
      cursor: pointer; 
      font-family: inherit; 
      font-weight: 600;
      transition: background-color 0.3s;
    }
    button[type="submit"]:disabled { 
      background: #b0bec5;
      cursor: not-allowed;
    }
    #message-box {
        padding: 1em;
        border-radius: 7px;
        margin-top: 1.2em;
        font-size: 1em;
        font-weight: 500;
        display: none;
        text-align: center;
    }
    .success {
        color: #36ab5f; background-color: #e8f5e9; border: 1px solid #a5d6a7;
    }
    .error {
        color: #d32f2f; background: #ffeaea; border: 1px solid #ef9a9a;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>แบบประเมินการสอน</h2>
    <form id="evaluationForm">
      <!-- Selection Dropdowns -->
      <div class="form-group"><label for="center">ศูนย์</label><select id="center" required></select></div>
      <div class="form-group"><label for="week">สัปดาห์</label><select id="week" required></select></div>
      <div class="form-group"><label for="day">วัน</label><select id="day" required></select></div>
      <div class="form-group"><label for="period">ช่วงเวลา</label><select id="period" required></select></div>
      
      <!-- Instructor Display -->
      <div class="form-group"><label>ผู้สอน 1</label><input type="text" id="instructor1" readonly></div>
      <div class="form-group"><label>ผู้สอน 2</label><input type="text" id="instructor2" readonly></div>

      <!-- Rating Sections -->
      <div class="form-group"><label>1. ความชัดเจนในการสอน</label><div class="rating-group" id="clarity_rating"></div></div>
      <div class="form-group"><label>2. การเตรียมการสอน</label><div class="rating-group" id="preparation_rating"></div></div>
      <div class="form-group"><label>3. การมีปฏิสัมพันธ์กับผู้เรียน</label><div class="rating-group" id="interaction_rating"></div></div>
      <div class="form-group"><label>4. การตรงต่อเวลา</label><div class="rating-group" id="punctuality_rating"></div></div>
      <div class="form-group"><label>5. ความพึงพอใจโดยรวม</label><div class="rating-group" id="satisfaction_rating"></div></div>
      <div class="form-group"><label for="comment">ข้อเสนอแนะเพิ่มเติม</label><textarea id="comment" rows="4"></textarea></div>

      <button type="submit">ส่งแบบประเมิน</button>
    </form>
    
    <div id="message-box"></div>
    <div id="success-container" style="display:none; text-align:center; color: #43a047; font-size: 1.2em;">ส่งแบบประเมินเรียบร้อยแล้ว ขอบคุณสำหรับการประเมิน!</div>
  </div>

<script>
// --- CONFIGURATION ---
const API_URL = 'https://script.google.com/macros/s/AKfycbxI1-QQAoSNJa-o_sM3v8ak6x4KxTRybpMjDcX0vrWH6fiUrU-LiuM9KoNm3J8bIMSC/exec';

// --- DATA ---
const centers = ['ลาดกระบัง', 'บางพลัด', 'ระยอง', 'ศรีราชา'];
const weeks = [1, 2, 3, 4, 5, 6, 7, 8];
const days = ['เสาร์', 'อาทิตย์'];
const periods = ['เช้า', 'บ่าย'];
const ratingCategories = ['clarity', 'preparation', 'interaction', 'punctuality', 'satisfaction'];
const ratingLabels = ['น้อยที่สุด', 'น้อย', 'ปานกลาง', 'มาก', 'มากที่สุด'];
let instructorsMap = {};

// --- UI FUNCTIONS ---
const messageBox = document.getElementById('message-box');
function showMessage(type, message) {
    messageBox.className = type;
    messageBox.textContent = message;
    messageBox.style.display = 'block';
}

function populateSelect(elementId, options, placeholder) {
    const select = document.getElementById(elementId);
    select.innerHTML = `<option value="">${placeholder}</option>` + 
        options.map(o => `<option value="${o}">${o}</option>`).join('');
}

function createRatingOptions(categoryId) {
    const container = document.getElementById(`${categoryId}_rating`);
    container.innerHTML = ratingLabels.map((label, index) => `
        <div class="rating-option">
            <input type="radio" name="${categoryId}" id="${categoryId}_${index+1}" value="${index+1}" required>
            <label for="${categoryId}_${index+1}">${label}</label>
        </div>`).join('');
}

// --- LOGIC ---
function updateInstructors() {
  const c = document.getElementById('center').value, w = document.getElementById('week').value, 
        d = document.getElementById('day').value, p = document.getElementById('period').value;
  document.getElementById('instructor1').value = instructorsMap[c]?.[w]?.[d]?.[p]?.instructor1 || '';
  document.getElementById('instructor2').value = instructorsMap[c]?.[w]?.[d]?.[p]?.instructor2 || '';
}

function fetchInstructors() {
  fetch(`${API_URL}?action=getInstructors`)
    .then(r => r.json()).then(data => {
      if (data.status !== 'success') throw new Error(data.message);
      instructorsMap = data.data || {};
      updateInstructors();
    }).catch(error => showMessage('error', `โหลดข้อมูลผู้สอนไม่สำเร็จ: ${error.message}`));
}

// --- INITIALIZATION ---
document.addEventListener('DOMContentLoaded', () => {
    populateSelect('center', centers, 'เลือกศูนย์');
    populateSelect('week', weeks, 'เลือกสัปดาห์');
    populateSelect('day', days, 'เลือกวัน');
    populateSelect('period', periods, 'เลือกช่วงเวลา');
    ratingCategories.forEach(createRatingOptions);

    ['center', 'week', 'day', 'period'].forEach(id => document.getElementById(id).addEventListener('change', updateInstructors));
    
    fetchInstructors();

    document.getElementById('evaluationForm').addEventListener('submit', function(e) {
        e.preventDefault();
        messageBox.style.display = 'none';

        const payload = { action: 'submitEvaluation' };
        let allRatingsProvided = true;

        // Collect form data
        ['center', 'week', 'day', 'period', 'instructor1', 'instructor2', 'comment'].forEach(id => payload[id] = document.getElementById(id).value);
        ratingCategories.forEach(id => {
            const val = document.querySelector(`input[name="${id}"]:checked`)?.value;
            if (val) payload[id] = val; else allRatingsProvided = false;
        });

        if (!payload.instructor1 && !payload.instructor2) return showMessage('error', 'กรุณาเลือกตารางสอนที่มีผู้สอน');
        if (!allRatingsProvided) return showMessage('error', 'กรุณาให้คะแนนให้ครบทุกหัวข้อ');
        
        const submitBtn = e.target.querySelector('button[type="submit"]');
        submitBtn.disabled = true;
        submitBtn.textContent = 'กำลังส่ง...';

        fetch(API_URL, { method: 'POST', body: JSON.stringify(payload) })
        .then(res => res.json()).then(data => {
            if (data.status !== 'success') throw new Error(data.message);
            document.getElementById('evaluationForm').style.display = 'none';
            document.getElementById('success-container').style.display = 'block';
        }).catch(error => showMessage('error', `เกิดข้อผิดพลาด: ${error.message}`))
        .finally(() => {
            submitBtn.disabled = false;
            submitBtn.textContent = 'ส่งแบบประเมิน';
        });
    });
});
</script>
</body>
</html>
