<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>แบบประเมินการสอน</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@400;600&display=swap');
    body { 
      font-family: 'Kanit', Tahoma, Arial, sans-serif; 
      background: #f7fafd; 
      margin: 0; 
      min-height: 100vh;
    }
    .container { 
      background: #fff; 
      padding: 2em; 
      border-radius: 18px; 
      max-width: 600px; 
      margin: 2em auto; 
      box-shadow: 0 8px 36px rgba(44, 62, 80, 0.11);
    }
    h2 { 
      text-align: center; 
      color: #2d87f0; 
      margin-top: 0; 
      margin-bottom: 1.5em;
    }
    .form-group { 
      margin-bottom: 1.5em;
    }
    label { 
      display: block; 
      margin-bottom: 0.5em; 
      color: #37474f; 
      font-weight: 500;
    }
    select, input[type="text"], textarea { 
      width: 100%; 
      padding: 0.7em; 
      border: 1.5px solid #b0bec5; 
      border-radius: 6px; 
      font-size: 1em; 
      font-family: inherit;
    }
    select:focus, input[type="text"]:focus, textarea:focus { 
      outline: none; 
      border-color: #2d87f0; 
      background: #e3f2fd;
    }
    .rating-group { 
      display: flex; 
      justify-content: space-between; 
      margin: 1em 0;
    }
    .rating-option { 
      flex: 1; 
      text-align: center;
    }
    .rating-option input { 
      margin-bottom: 0.5em;
    }
    button[type="submit"] { 
      width: 100%; 
      padding: 0.8em; 
      background: linear-gradient(90deg,#2d87f0 60%,#5ad4fc 100%); 
      color: white; 
      border: none; 
      border-radius: 6px; 
      font-size: 1.1em; 
      cursor: pointer; 
      font-family: inherit; 
      font-weight: 600;
    }
    button[type="submit"]:disabled { 
      background: #b0bec5;
      cursor: not-allowed;
    }
    .error-msg { 
      color: #d32f2f; 
      background: #ffeaea; 
      border: 1px solid #ef9a9a; 
      padding: 1em; 
      border-radius: 7px; 
      margin-top: 1em; 
      display: none;
    }
    .success-msg { 
      text-align: center; 
      font-size: 1.2em; 
      color: #43a047; 
      margin-top: 2em; 
      font-weight: 600; 
      display: none;
    }
    @media (max-width: 480px) {
      .container { 
        margin: 1em; 
        padding: 1.5em;
      }
      .rating-group { 
        flex-direction: column; 
        gap: 0.5em;
      }
      .rating-option { 
        display: flex; 
        align-items: center;
        gap: 1em;
      }
      .rating-option input { 
        margin: 0;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>แบบประเมินการสอน</h2>
    <form id="evaluationForm">
      <div class="form-group">
        <label for="center">ศูนย์</label>
        <select id="center" required>
          <option value="">เลือกศูนย์</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="week">สัปดาห์</label>
        <select id="week" required>
          <option value="">เลือกสัปดาห์</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="day">วัน</label>
        <select id="day" required>
          <option value="">เลือกวัน</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="period">ช่วงเวลา</label>
        <select id="period" required>
          <option value="">เลือกช่วงเวลา</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>ผู้สอน 1</label>
        <input type="text" id="instructor1" readonly>
      </div>
      
      <div class="form-group">
        <label>ผู้สอน 2</label>
        <input type="text" id="instructor2" readonly>
      </div>

      <div class="form-group">
        <label>1. ความชัดเจนในการสอน</label>
        <div class="rating-group">
          <div class="rating-option">
            <input type="radio" name="clarity" value="1" required>
            <span>น้อยที่สุด</span>
          </div>
          <div class="rating-option">
            <input type="radio" name="clarity" value="2">
            <span>น้อย</span>
          </div>
          <div class="rating-option">
            <input type="radio" name="clarity" value="3">
            <span>ปานกลาง</span>
          </div>
          <div class="rating-option">
            <input type="radio" name="clarity" value="4">
            <span>มาก</span>
          </div>
          <div class="rating-option">
            <input type="radio" name="clarity" value="5">
            <span>มากที่สุด</span>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label>2. การเตรียมการสอน</label>
        <div class="rating-group">
          <div class="rating-option">
            <input type="radio" name="preparation" value="1" required>
            <span>น้อยที่สุด</span>
          </div>
          <div class="rating-option">
            <input type="radio" name="preparation" value="2">
            <span>น้อย</span>
          </div>
          <div class="rating-option">
            <input type="radio" name="preparation" value="3">
            <span>ปานกลาง</span>
          </div>
          <div class="rating-option">
            <input type="radio" name="preparation" value="4">
            <span>มาก</span>
          </div>
          <div class="rating-option">
            <input type="radio" name="preparation" value="5">
            <span>มากที่สุด</span>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label>3. การมีปฏิสัมพันธ์กับผู้เรียน</label>
        <div class="rating-group">
          <div class="rating-option">
            <input type="radio" name="interaction" value="1" required>
            <span>น้อยที่สุด</span>
          </div>
          <div class="rating-option">
            <input type="radio" name="interaction" value="2">
            <span>น้อย</span>
          </div>
          <div class="rating-option">
            <input type="radio" name="interaction" value="3">
            <span>ปานกลาง</span>
          </div>
          <div class="rating-option">
            <input type="radio" name="interaction" value="4">
            <span>มาก</span>
          </div>
          <div class="rating-option">
            <input type="radio" name="interaction" value="5">
            <span>มากที่สุด</span>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label>4. การตรงต่อเวลา</label>
        <div class="rating-group">
          <div class="rating-option">
            <input type="radio" name="punctuality" value="1" required>
            <span>น้อยที่สุด</span>
          </div>
          <div class="rating-option">
            <input type="radio" name="punctuality" value="2">
            <span>น้อย</span>
          </div>
          <div class="rating-option">
            <input type="radio" name="punctuality" value="3">
            <span>ปานกลาง</span>
          </div>
          <div class="rating-option">
            <input type="radio" name="punctuality" value="4">
            <span>มาก</span>
          </div>
          <div class="rating-option">
            <input type="radio" name="punctuality" value="5">
            <span>มากที่สุด</span>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label>5. ความพึงพอใจโดยรวม</label>
        <div class="rating-group">
          <div class="rating-option">
            <input type="radio" name="satisfaction" value="1" required>
            <span>น้อยที่สุด</span>
          </div>
          <div class="rating-option">
            <input type="radio" name="satisfaction" value="2">
            <span>น้อย</span>
          </div>
          <div class="rating-option">
            <input type="radio" name="satisfaction" value="3">
            <span>ปานกลาง</span>
          </div>
          <div class="rating-option">
            <input type="radio" name="satisfaction" value="4">
            <span>มาก</span>
          </div>
          <div class="rating-option">
            <input type="radio" name="satisfaction" value="5">
            <span>มากที่สุด</span>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label for="comment">ข้อเสนอแนะเพิ่มเติม</label>
        <textarea id="comment" rows="4"></textarea>
      </div>

      <button type="submit">ส่งแบบประเมิน</button>
    </form>
    
    <div class="error-msg" id="errorMsg"></div>
    <div class="success-msg" id="successMsg">ส่งแบบประเมินเรียบร้อยแล้ว ขอบคุณสำหรับการประเมิน!</div>
  </div>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbxI1-QQAoSNJa-o_sM3v8ak6x4KxTRybpMjDcX0vrWH6fiUrU-LiuM9KoNm3J8bIMSC/exec';

const centers = ['ลาดกระบัง', 'บางพลัด', 'ระยอง', 'ศรีราชา'];
const weeks = [1,2,3,4,5,6,7,8];
const days = ['เสาร์','อาทิตย์'];
const periods = ['เช้า','บ่าย'];

let instructorsMap = {};

function populateSelects() {
  const centerSelect = document.getElementById('center');
  const weekSelect = document.getElementById('week');
  const daySelect = document.getElementById('day');
  const periodSelect = document.getElementById('period');
  
  centerSelect.innerHTML = '<option value="">เลือกศูนย์</option>' + 
    centers.map(c => `<option value="${c}">${c}</option>`).join('');
  
  weekSelect.innerHTML = '<option value="">เลือกสัปดาห์</option>' + 
    weeks.map(w => `<option value="${w}">${w}</option>`).join('');
  
  daySelect.innerHTML = '<option value="">เลือกวัน</option>' + 
    days.map(d => `<option value="${d}">${d}</option>`).join('');
  
  periodSelect.innerHTML = '<option value="">เลือกช่วงเวลา</option>' + 
    periods.map(p => `<option value="${p}">${p}</option>`).join('');
}

function updateInstructors() {
  const center = document.getElementById('center').value;
  const week = document.getElementById('week').value;
  const day = document.getElementById('day').value;
  const period = document.getElementById('period').value;
  
  document.getElementById('instructor1').value = '';
  document.getElementById('instructor2').value = '';
  
  if (center && week && day && period) {
    if (instructorsMap[center]?.[week]?.[day]?.[period]) {
      const data = instructorsMap[center][week][day][period];
      document.getElementById('instructor1').value = data.instructor1 || '';
      document.getElementById('instructor2').value = data.instructor2 || '';
    }
  }
}

function fetchInstructors() {
  fetch(API_URL + '?action=getInstructors')
    .then(r => r.json())
    .then(data => {
      if (data.status === 'success') {
        instructorsMap = data.data || {};
        updateInstructors();
      } else {
        throw new Error(data.message || 'โหลดข้อมูลไม่สำเร็จ');
      }
    })
    .catch(error => {
      document.getElementById('errorMsg').textContent = error.message;
      document.getElementById('errorMsg').style.display = '';
    });
}

document.getElementById('center').addEventListener('change', updateInstructors);
document.getElementById('week').addEventListener('change', updateInstructors);
document.getElementById('day').addEventListener('change', updateInstructors);
document.getElementById('period').addEventListener('change', updateInstructors);

document.getElementById('evaluationForm').addEventListener('submit', function(e) {
  e.preventDefault();
  
  const errorMsg = document.getElementById('errorMsg');
  const successMsg = document.getElementById('successMsg');
  errorMsg.style.display = 'none';
  successMsg.style.display = 'none';
  
  const center = document.getElementById('center').value;
  const week = document.getElementById('week').value;
  const day = document.getElementById('day').value;
  const period = document.getElementById('period').value;
  const instructor1 = document.getElementById('instructor1').value;
  const instructor2 = document.getElementById('instructor2').value;
  
  if (!instructor1 && !instructor2) {
    errorMsg.textContent = 'กรุณาเลือกศูนย์/สัปดาห์/วัน/เวลา ที่มีผู้สอน';
    errorMsg.style.display = '';
    return;
  }
  
  const clarity = document.querySelector('input[name="clarity"]:checked')?.value;
  const preparation = document.querySelector
